<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HoH â€” Coach Milli</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="HoH Milli">
<meta name="theme-color" content="#0f1923">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --navy:#0f1923;--navy2:#1a2744;--accent:#e8a838;--green:#2ecc71;
  --red:#e74c3c;--teal:#00b4d8;--pink:#e91e8c;--purple:#9c6fff;
  --text:#f0f4ff;--muted:#8899bb;--card:rgba(255,255,255,0.04);
  --border:rgba(255,255,255,0.08);--radius:14px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;background:var(--navy);color:var(--text);font-family:"DM Sans",sans-serif;overflow:hidden;}
.screen{display:none;flex-direction:column;height:100vh;overflow:hidden;}
.screen.active{display:flex;}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 18px 10px;flex-shrink:0;background:linear-gradient(180deg,rgba(15,25,35,1) 0%,rgba(15,25,35,0) 100%);}
.topbar-title{font-family:"Bebas Neue",sans-serif;font-size:22px;letter-spacing:2px;color:var(--accent);}
.topbar-sub{font-size:11px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;}
.back-btn{background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:18px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
.scroll{flex:1;overflow-y:auto;padding:0 16px 100px;-webkit-overflow-scrolling:touch;}
.scroll::-webkit-scrollbar{display:none;}
.bnav{display:flex;background:var(--navy2);border-top:1px solid var(--border);flex-shrink:0;padding:8px 0 calc(8px + env(safe-area-inset-bottom));}
.nb{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 4px;cursor:pointer;font-size:10px;color:var(--muted);letter-spacing:0.5px;text-transform:uppercase;}
.nb .ni{font-size:20px;}
.nb.active{color:var(--accent);}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;}
.hero{background:linear-gradient(135deg,var(--navy2) 0%,#0d2137 100%);border-radius:var(--radius);padding:20px;margin-bottom:16px;border:1px solid var(--border);position:relative;overflow:hidden;}
.hero::before{content:"HoH";position:absolute;right:-10px;top:-20px;font-family:"Bebas Neue",sans-serif;font-size:120px;color:rgba(255,255,255,0.03);letter-spacing:-4px;line-height:1;}
.sc-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.sc{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 12px;cursor:pointer;transition:all 0.2s;text-align:center;}
.sc:active{transform:scale(0.96);}
.sc-label{font-family:"Bebas Neue",sans-serif;font-size:20px;letter-spacing:2px;}
.sc-ath{font-size:11px;color:var(--muted);margin-top:3px;}
.sc-type{font-size:10px;margin-top:6px;font-weight:600;text-transform:uppercase;}
.qs{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px;}
.qc{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 8px;text-align:center;}
.qn{font-family:"JetBrains Mono",monospace;font-size:22px;font-weight:600;color:var(--accent);}
.ql{font-size:10px;color:var(--muted);margin-top:2px;text-transform:uppercase;letter-spacing:0.5px;}
.ath-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;display:flex;align-items:center;gap:14px;margin-bottom:10px;}
.ath-card:active{transform:scale(0.98);}
.avatar{width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:"Bebas Neue",sans-serif;font-size:22px;flex-shrink:0;border:2px solid;}
.tag{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;padding:2px 8px;border-radius:20px;background:rgba(255,255,255,0.08);}
.switcher{display:flex;gap:0;margin-bottom:16px;border-radius:12px;overflow:hidden;border:1px solid var(--border);}
.sw-btn{flex:1;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;font-family:"Bebas Neue",sans-serif;font-size:16px;letter-spacing:1px;border-right:1px solid var(--border);}
.sw-btn:last-child{border-right:none;}
.sw-btn.active-a{color:var(--navy);font-weight:700;}
.sw-sub{font-size:10px;margin-top:3px;font-family:"DM Sans",sans-serif;font-weight:400;color:var(--muted);}
.sw-btn.active-a .sw-sub{color:var(--navy);opacity:0.7;}
.day-toggle{display:flex;gap:8px;margin-bottom:14px;}
.day-btn{flex:1;padding:10px;border-radius:10px;text-align:center;font-family:"Bebas Neue",sans-serif;font-size:16px;letter-spacing:1px;cursor:pointer;border:1px solid var(--border);background:var(--card);color:var(--muted);transition:all 0.2s;}
.day-btn.active{background:var(--navy2);color:var(--text);border-color:var(--accent);}
.lift-block{margin-bottom:14px;}
.lift-name{font-family:"Bebas Neue",sans-serif;font-size:17px;letter-spacing:1px;display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap;}
.lift-scheme{font-size:12px;color:var(--muted);font-family:"JetBrains Mono",monospace;}
.lift-pct{font-size:11px;color:var(--accent);background:rgba(232,168,56,0.1);padding:2px 8px;border-radius:20px;}
.sets-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;}
.set-box{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:8px 4px;text-align:center;cursor:pointer;transition:all 0.15s;min-height:52px;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.set-box:active{transform:scale(0.94);}
.set-box.done{border-color:var(--green);background:rgba(46,204,113,0.08);}
.set-num{font-size:9px;color:var(--muted);text-transform:uppercase;}
.set-val{font-family:"JetBrains Mono",monospace;font-size:11px;font-weight:600;margin-top:2px;}
.divider{display:flex;align-items:center;gap:10px;margin:18px 0 14px;font-family:"Bebas Neue",sans-serif;font-size:13px;letter-spacing:2px;color:var(--muted);}
.divider::after{content:"";flex:1;height:1px;background:var(--border);}
.sprint-row{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:8px;}
.srinput{background:transparent;border:none;border-bottom:1px solid var(--border);color:var(--accent);font-family:"JetBrains Mono",monospace;font-size:14px;width:75px;text-align:center;outline:none;padding:2px 4px;}
.srinput::placeholder{color:var(--muted);font-size:12px;}
.vrow{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:8px;}
.vinput{background:rgba(255,255,255,0.05);border:1px solid var(--border);color:var(--text);font-size:12px;border-radius:6px;padding:4px 6px;width:46px;text-align:center;outline:none;}
.notes-area{width:100%;background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px;font-family:"DM Sans",sans-serif;padding:12px;outline:none;resize:none;min-height:80px;line-height:1.5;}
.notes-area::placeholder{color:var(--muted);}
.save-btn{width:100%;padding:18px;background:linear-gradient(135deg,#e8a838,#ff6b35);border:none;border-radius:14px;font-family:"Bebas Neue",sans-serif;font-size:20px;letter-spacing:2px;color:#0f1923;cursor:pointer;font-weight:700;}
.lb-sec{margin-bottom:20px;}
.lb-hdr{display:flex;align-items:center;gap:8px;padding:12px 0 8px;font-family:"Bebas Neue",sans-serif;font-size:16px;letter-spacing:1.5px;border-bottom:1px solid var(--border);margin-bottom:8px;}
.lb-row{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;margin-bottom:6px;}
.lb-rank{width:28px;font-family:"Bebas Neue",sans-serif;font-size:16px;color:var(--muted);}
.lb-name{flex:1;font-weight:600;font-size:14px;}
.lb-val{font-family:"JetBrains Mono",monospace;font-weight:600;font-size:15px;}
.lb-row.r1{background:rgba(249,168,37,0.12);border:1px solid rgba(249,168,37,0.3);}
.lb-row.r2{background:rgba(187,187,187,0.08);border:1px solid rgba(187,187,187,0.2);}
.lb-row.r3{background:rgba(205,127,50,0.08);border:1px solid rgba(205,127,50,0.2);}
.lb-row.r1 .lb-val{color:var(--accent);}
.lb-row.r2 .lb-val{color:#bbb;}
.lb-row.r3 .lb-val{color:#cd7f32;}
.phase-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;}
.phase-prog{height:6px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;margin:10px 0;}
.phase-bar{height:100%;border-radius:3px;transition:width 0.8s ease;}
.wk-dots{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;}
.wk-dot{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:"Bebas Neue",sans-serif;font-size:14px;border:1px solid var(--border);background:var(--card);color:var(--muted);cursor:pointer;}
.wk-dot.done{background:var(--green);border-color:var(--green);color:var(--navy);}
.wk-dot.cur{border-color:var(--accent);color:var(--accent);box-shadow:0 0 10px rgba(232,168,56,0.3);}
.wk-detail{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;}
.wk-row{display:flex;justify-content:space-between;align-items:flex-start;padding:8px 0;border-bottom:1px solid var(--border);}
.wk-row:last-child{border-bottom:none;}
.wk-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;padding-top:2px;flex-shrink:0;}
.wk-val{font-size:13px;font-weight:600;text-align:right;max-width:65%;}
.pr-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;}
.pr-mini{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;}
.pr-mini-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;}
.pr-mini-val{font-family:"JetBrains Mono",monospace;font-size:17px;font-weight:600;margin-top:4px;}
.hist-row{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:8px;}
.modal-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:100;align-items:flex-end;justify-content:center;backdrop-filter:blur(4px);}
.modal-ov.show{display:flex;}
.modal{background:var(--navy2);border-radius:20px 20px 0 0;padding:24px 20px 40px;width:100%;max-width:500px;border-top:1px solid var(--border);animation:slideUp 0.25s ease;}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.minput{width:100%;background:rgba(255,255,255,0.06);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:20px;font-family:"JetBrains Mono",monospace;text-align:center;padding:14px;outline:none;font-weight:600;}
.minput:focus{border-color:var(--accent);}
.mbtn{width:100%;padding:16px;border:none;border-radius:12px;font-family:"Bebas Neue",sans-serif;font-size:18px;letter-spacing:2px;cursor:pointer;}
.mbtn-p{background:var(--accent);color:var(--navy);margin-bottom:10px;}
.mbtn-s{background:var(--card);color:var(--muted);border:1px solid var(--border);}
.toast{display:none;position:fixed;top:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#f9a825,#ff6b35);color:var(--navy);font-family:"Bebas Neue",sans-serif;font-size:15px;letter-spacing:1.5px;padding:12px 24px;border-radius:30px;z-index:200;animation:tb 0.4s ease;white-space:nowrap;box-shadow:0 4px 20px rgba(249,168,37,0.4);max-width:92vw;text-align:center;}
.toast.show{display:block;}
@keyframes tb{0%{transform:translateX(-50%) scale(0.8) translateY(-10px)}60%{transform:translateX(-50%) scale(1.05)}100%{transform:translateX(-50%) scale(1)}}
.sync-dot{width:8px;height:8px;border-radius:50%;background:var(--muted);display:inline-block;transition:background 0.3s;}
.sync-dot.syncing{background:var(--accent);animation:pulse 1s infinite;}
.sync-dot.synced{background:var(--green);}
.sync-dot.error{background:var(--red);}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
.si{background:rgba(255,255,255,0.06);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:12px;font-family:"JetBrains Mono",monospace;padding:8px 10px;outline:none;width:100%;margin-top:8px;}
.si:focus{border-color:var(--accent);}
.sbtn{background:var(--accent);color:var(--navy);border:none;border-radius:8px;padding:10px 20px;font-family:"Bebas Neue",sans-serif;font-size:16px;letter-spacing:1px;cursor:pointer;margin-top:8px;}
.dbtn{background:rgba(231,76,60,0.15);color:var(--red);border:1px solid rgba(231,76,60,0.3);border-radius:8px;padding:10px 20px;font-family:"Bebas Neue",sans-serif;font-size:14px;letter-spacing:1px;cursor:pointer;}
/* sprint rep grid */
.rep-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:6px;}
.rep-box{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:8px 4px;text-align:center;}
.rep-box input{background:transparent;border:none;border-bottom:1px solid var(--border);font-family:"JetBrains Mono",monospace;font-size:13px;font-weight:600;width:100%;text-align:center;outline:none;padding:3px 0;margin-top:4px;}
.prescription-box{border-radius:10px;padding:12px 14px;margin-bottom:14px;}
</style>
</head>
<body>

<!-- HOME -->
<div class="screen active" id="s-home">
  <div class="topbar">
    <div><div class="topbar-title">House of Hustle</div><div class="topbar-sub">Coach Milli</div></div>
    <div style="display:flex;align-items:center;gap:10px;">
      <span id="sync-dot" class="sync-dot" title="Sync"></span>
      <div style="cursor:pointer;font-size:22px;" onclick="go('s-settings')">âš™ï¸</div>
    </div>
  </div>
  <div class="scroll">
    <div class="hero">
      <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px;">Today</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:32px;letter-spacing:2px;color:var(--accent);" id="h-date"></div>
      <div style="font-size:13px;color:var(--muted);margin-top:2px;" id="h-day"></div>
    </div>
    <div style="font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;color:var(--muted);margin-bottom:8px;">START A SESSION</div>
    <div class="sc-grid">
      <div class="sc" style="border-color:rgba(233,30,140,0.3)" onclick="startSession('A')">
        <div class="sc-label" style="color:var(--pink)">Session A</div>
        <div class="sc-ath">Xavier + Gabby</div>
        <div class="sc-type" style="color:var(--pink)">ğŸƒ In-Season Track</div>
      </div>
      <div class="sc" style="border-color:rgba(0,180,216,0.3)" onclick="startSession('B')">
        <div class="sc-label" style="color:var(--teal)">Session B</div>
        <div class="sc-ath">Joey + Vera</div>
        <div class="sc-type" style="color:var(--teal)">ğŸ’ª Strength</div>
      </div>
      <div class="sc" style="border-color:rgba(156,111,255,0.3)" onclick="startSession('C')">
        <div class="sc-label" style="color:var(--purple)">Session C</div>
        <div class="sc-ath">Joey Solo</div>
        <div class="sc-type" style="color:var(--purple)">ğŸ’ª Heavy Day</div>
      </div>
      <div class="sc" style="border-color:rgba(232,168,56,0.3)" onclick="go('s-athletes')">
        <div class="sc-label" style="color:var(--accent)">Athletes</div>
        <div class="sc-ath">View all 4</div>
        <div class="sc-type" style="color:var(--accent)">PRs &amp; History</div>
      </div>
    </div>
    <div class="qs" id="h-stats"></div>
    <div style="font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;color:var(--muted);margin-bottom:8px;">RECENT SESSIONS</div>
    <div id="h-recent"></div>
  </div>
  <div class="bnav">
    <div class="nb active" onclick="go('s-home')"><div class="ni">ğŸ </div>Home</div>
    <div class="nb" onclick="go('s-athletes')"><div class="ni">ğŸ‘¥</div>Athletes</div>
    <div class="nb" onclick="go('s-lb')"><div class="ni">ğŸ†</div>Board</div>
    <div class="nb" onclick="go('s-phase')"><div class="ni">ğŸ“…</div>Phase</div>
  </div>
</div>

<!-- ATHLETES -->
<div class="screen" id="s-athletes">
  <div class="topbar"><div><div class="topbar-title">Athletes</div><div class="topbar-sub">4 Active</div></div></div>
  <div class="scroll" style="padding-top:8px"><div id="ath-list"></div></div>
  <div class="bnav">
    <div class="nb" onclick="go('s-home')"><div class="ni">ğŸ </div>Home</div>
    <div class="nb active" onclick="go('s-athletes')"><div class="ni">ğŸ‘¥</div>Athletes</div>
    <div class="nb" onclick="go('s-lb')"><div class="ni">ğŸ†</div>Board</div>
    <div class="nb" onclick="go('s-phase')"><div class="ni">ğŸ“…</div>Phase</div>
  </div>
</div>

<!-- ATHLETE DETAIL -->
<div class="screen" id="s-ath-detail">
  <div class="topbar">
    <div class="back-btn" onclick="go('s-athletes')">â†</div>
    <div style="text-align:right"><div class="topbar-title" id="d-name"></div><div class="topbar-sub" id="d-sport"></div></div>
  </div>
  <div class="scroll" style="padding-top:8px">
    <div class="pr-grid" id="d-prs"></div>
    <div style="font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;color:var(--muted);margin-bottom:8px;">UPDATE A PR</div>
    <div id="d-update"></div>
    <div style="font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;color:var(--muted);margin:14px 0 8px;">HISTORY</div>
    <div id="d-hist"></div>
  </div>
</div>

<!-- LEADERBOARD -->
<div class="screen" id="s-lb">
  <div class="topbar"><div><div class="topbar-title">Leaderboard</div><div class="topbar-sub">All Athletes</div></div></div>
  <div class="scroll" style="padding-top:8px" id="lb-content"></div>
  <div class="bnav">
    <div class="nb" onclick="go('s-home')"><div class="ni">ğŸ </div>Home</div>
    <div class="nb" onclick="go('s-athletes')"><div class="ni">ğŸ‘¥</div>Athletes</div>
    <div class="nb active" onclick="go('s-lb')"><div class="ni">ğŸ†</div>Board</div>
    <div class="nb" onclick="go('s-phase')"><div class="ni">ğŸ“…</div>Phase</div>
  </div>
</div>

<!-- PHASE -->
<div class="screen" id="s-phase">
  <div class="topbar"><div><div class="topbar-title">Phase Plans</div><div class="topbar-sub">Auto-advancing weekly</div></div></div>
  <div class="scroll" style="padding-top:8px" id="phase-content"></div>
  <div class="bnav">
    <div class="nb" onclick="go('s-home')"><div class="ni">ğŸ </div>Home</div>
    <div class="nb" onclick="go('s-athletes')"><div class="ni">ğŸ‘¥</div>Athletes</div>
    <div class="nb" onclick="go('s-lb')"><div class="ni">ğŸ†</div>Board</div>
    <div class="nb active" onclick="go('s-phase')"><div class="ni">ğŸ“…</div>Phase</div>
  </div>
</div>

<!-- SESSION -->
<div class="screen" id="s-session">
  <div class="topbar">
    <div class="back-btn" onclick="leaveSession()">â†</div>
    <div style="text-align:right"><div class="topbar-title" id="sess-title"></div><div class="topbar-sub" id="sess-date"></div></div>
  </div>
  <div class="scroll" style="padding-top:8px" id="sess-content"></div>
</div>

<!-- EDIT SESSION -->
<div class="screen" id="s-edit">
  <div class="topbar">
    <div class="back-btn" onclick="go('s-home')">â†</div>
    <div style="text-align:right"><div class="topbar-title" id="edit-title">Edit Session</div><div class="topbar-sub" id="edit-date"></div></div>
  </div>
  <div class="scroll" style="padding-top:8px" id="edit-content"></div>
</div>

<!-- SETTINGS -->
<div class="screen" id="s-settings">
  <div class="topbar">
    <div class="back-btn" onclick="go('s-home')">â†</div>
    <div><div class="topbar-title">Settings</div><div class="topbar-sub">Sync &amp; Data</div></div>
  </div>
  <div class="scroll" style="padding-top:8px">
    <div class="card" style="border-color:rgba(46,204,113,0.3);margin-bottom:12px;">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1.5px;color:#2ecc71;margin-bottom:6px;">ğŸ“± Add to iPhone Home Screen</div>
      <div style="font-size:12px;color:var(--muted);line-height:1.8;">
        <b style="color:var(--text);">1.</b> Open this file in <b style="color:var(--text);">Safari</b><br>
        <b style="color:var(--text);">2.</b> Tap the Share button â¬† at the bottom<br>
        <b style="color:var(--text);">3.</b> Tap <b style="color:var(--text);">"Add to Home Screen"</b> â†’ Add
      </div>
    </div>
    <div class="card" style="border-color:rgba(232,168,56,0.3);margin-bottom:12px;">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1.5px;color:var(--accent);margin-bottom:6px;">ğŸ”— Google Sheets Sync</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:10px;">Paste your Apps Script Web App URL to sync sessions and PRs automatically.</div>
      <div id="sync-status-box" style="padding:8px 12px;border-radius:8px;font-size:12px;margin-bottom:10px;background:rgba(255,255,255,0.04);border:1px solid var(--border);">Status: <span id="sync-status-text" style="color:var(--muted);">Not configured</span></div>
      <label style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Apps Script URL</label>
      <input class="si" id="sheets-url" placeholder="https://script.google.com/macros/s/..." type="url">
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button class="sbtn" onclick="saveSheetURL()">SAVE &amp; TEST</button>
        <button class="dbtn" onclick="clearSheetURL()">Clear</button>
      </div>
    </div>
    <div class="card" style="margin-bottom:12px;">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1.5px;margin-bottom:8px;">ğŸ“‹ Setup Instructions</div>
      <div style="font-size:12px;color:var(--muted);line-height:1.8;">
        <b style="color:var(--text);">1.</b> Open Google Sheets â†’ create new sheet<br>
        <b style="color:var(--text);">2.</b> Extensions â†’ Apps Script<br>
        <b style="color:var(--text);">3.</b> Delete all code â†’ paste script below<br>
        <b style="color:var(--text);">4.</b> Deploy â†’ New Deployment â†’ Web App<br>
        <b style="color:var(--text);">5.</b> Execute as: Me Â· Access: Anyone<br>
        <b style="color:var(--text);">6.</b> Authorize â†’ copy URL â†’ paste above
      </div>
    </div>
    <div class="card" style="margin-bottom:12px;">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1.5px;margin-bottom:8px;">ğŸ“„ Apps Script Code</div>
      <div style="background:rgba(0,0,0,0.4);border-radius:8px;padding:12px;font-family:'JetBrains Mono',monospace;font-size:10px;color:#aef;line-height:1.6;max-height:180px;overflow-y:auto;white-space:pre-wrap;" id="script-display"></div>
      <button class="sbtn" style="width:100%;margin-top:8px;" onclick="copyScript()">COPY SCRIPT</button>
    </div>
    <div class="card" style="margin-bottom:12px;">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1.5px;margin-bottom:8px;">ğŸ’¾ Local Data</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:12px;">Sessions on device: <span id="local-count" style="color:var(--accent);">0</span></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="dbtn" onclick="forceSyncAll()">â†‘ Force Sync All</button>
        <button class="dbtn" onclick="clearAll()">ğŸ—‘ Clear All</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-ov" id="modal" onclick="closeModalOv(event)">
  <div class="modal">
    <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;margin-bottom:6px;" id="m-title">Log Set</div>
    <div style="font-size:12px;color:var(--muted);margin-bottom:20px;" id="m-sub"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;">
      <div><label style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px;" id="m-l1">Weight</label><input class="minput" id="m-w" type="number" inputmode="decimal" placeholder="0"></div>
      <div><label style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px;" id="m-l2">Reps</label><input class="minput" id="m-r" type="number" inputmode="numeric" placeholder="0"></div>
    </div>
    <button class="mbtn mbtn-p" onclick="saveModal()">LOG SET</button>
    <button class="mbtn mbtn-s" onclick="closeModal()">Cancel</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ATH = {
  Xavier:{color:"#1e90ff",bg:"rgba(30,144,255,0.12)",age:13,school:"Middle School",sport:"Track & Field â€” Mid/Long",sess:"A",status:"IN SEASON",
    prs:{"Bench Press":{v:55,u:"lbs",d:"02/2026"},"Overhead Press":{v:15,u:"lbs",d:"02/2026"},"Squat":{v:95,u:"lbs",d:"02/2026"},"Deadlift":{v:105,u:"lbs",d:"02/15/26"},"Hack Squat":{v:55,u:"lbs",d:"02/2026"},"Pull-Ups":{v:6,u:"reps",d:"02/2026",note:"grnâ†’purp band"},"Mile Time":{v:"7:47",u:"min",d:"02/2026",lo:true},"200m":{v:"30.42",u:"sec",d:"02/24/26",lo:true}},
    hist:[{d:"02/24/26",l:"200m",v:"30.42 sec",n:"First meet ğŸ†"},{d:"02/15/26",l:"Deadlift",v:"105 lbs",n:"PR"}]},
  Gabby:{color:"#e91e8c",bg:"rgba(233,30,140,0.12)",age:16,school:"High School",sport:"Basketball + T&F â€” IN SEASON",sess:"A",status:"IN SEASON",
    prs:{"Bench Press":{v:65,u:"lbs",d:"02/2026"},"Overhead Press":{v:15,u:"lbs",d:"02/2026"},"Squat":{v:135,u:"lbs",d:"02/2026"},"Deadlift":{v:90,u:"lbs",d:"02/2026"},"Hack Squat":{v:70,u:"lbs",d:"02/2026"},"Pull-Ups":{v:2,u:"reps",d:"02/2026",note:"grn band"},"Mile Time":{v:"8:41",u:"min",d:"02/2026",lo:true}},
    hist:[]},
  Joey:{color:"#00b4d8",bg:"rgba(0,180,216,0.12)",age:17,school:"High School",sport:"Swim & Dive â€” OFF SEASON",sess:"B+C",status:"OFF SEASON",
    prs:{"Bench Press":{v:135,u:"lbs",d:"02/2026"},"Overhead Press":{v:20,u:"lbs",d:"02/2026"},"Squat":{v:185,u:"lbs",d:"02/2026"},"Deadlift":{v:285,u:"lbs",d:"02/15/26"},"Hack Squat":{v:90,u:"lbs",d:"02/2026"},"Pull-Ups":{v:6,u:"reps",d:"02/2026",note:"purp band"},"Mile Time":{v:"8:07",u:"min",d:"02/08/26",lo:true}},
    hist:[{d:"02/15/26",l:"Deadlift",v:"285 lbs",n:"PR ğŸ”¥"},{d:"02/08/26",l:"Mile Time",v:"8:07",n:"Baseline"}]},
  Vera:{color:"#2ecc71",bg:"rgba(46,204,113,0.12)",age:13,school:"Middle School",sport:"T&F â€” Discus Throw",sess:"B",status:"DISCUS SEASON",
    prs:{"Bench Press":{v:75,u:"lbs",d:"02/2026"},"Overhead Press":{v:15,u:"lbs",d:"02/2026"},"Squat":{v:95,u:"lbs",d:"02/2026"},"Deadlift":{v:95,u:"lbs",d:"02/2026"},"Hack Squat":{v:55,u:"lbs",d:"02/2026"},"Pull-Ups":{v:2,u:"reps",d:"02/2026",note:"grn band"}},
    hist:[]}
};

const TIMED = new Set(["Mile Time","200m","100m","60m","40 Yard Dash","Mile / 1600m"]);

// Session definitions
const SESS = {
  A:{label:"Session A",athletes:["Xavier","Gabby"],color:"#e91e8c",hasSprint:true,
    day1:[{n:"Bench Press",s:"5x5",p:"60-70%"},{n:"Overhead Press",s:"3x8",p:"â€”"},{n:"Pull-Ups",s:"4x6",p:"BW/Band"}],
    day2:[{n:"Squat",s:"4x4",p:"60-65%"},{n:"Deadlift",s:"3x4",p:"60-65%"},{n:"Hack Squat",s:"3x5",p:"â€”"},{n:"Bulgarian Split Squat",s:"3x6",p:"ea leg"}],
    vmax:["Resisted Sprint 10yd","Resisted Sprint 20yd","Power Skip","Box Jump","Bounding","Broad Jump","Ankle Stiffness"]},
  B:{label:"Session B",athletes:["Joey","Vera"],color:"#00b4d8",hasSprint:false,
    day1:[{n:"Bench Press",s:"5x5",p:"60-70%"},{n:"Overhead Press",s:"3x8",p:"â€”"},{n:"Pull-Ups",s:"4x6",p:"BW/Band"},{n:"DB Row",s:"3x10",p:"ea arm"}],
    day2:[{n:"Squat",s:"5x5",p:"65-75%"},{n:"Deadlift",s:"5x4",p:"65-75%"},{n:"Hack Squat",s:"3x5",p:"â€”"},{n:"RDL",s:"3x8",p:"â€”"},{n:"Rotational Med Ball Throw",s:"4x6",p:"ea side"}],
    vmax:["Box Jump","Power Skip","Rotational Med Ball Throw","Bounding"],
    runDists:["Mile / 1600m"]},
  C:{label:"Session C (Joey Solo)",athletes:["Joey"],color:"#9c6fff",hasSprint:false,
    day1:[{n:"Bench Press",s:"5x5",p:"70-80%"},{n:"Incline DB Press",s:"3x8",p:"â€”"},{n:"Overhead Press",s:"3x8",p:"â€”"},{n:"Pull-Ups",s:"4x6",p:"Unassisted goal"},{n:"DB Row",s:"3x10",p:"â€”"}],
    day2:[{n:"Squat",s:"5x5",p:"70-80%"},{n:"Deadlift",s:"5x4",p:"75-85%"},{n:"Hack Squat",s:"4x5",p:"â€”"},{n:"RDL",s:"3x8",p:"â€”"},{n:"Leg Press",s:"3x10",p:"accessory"}],
    vmax:[],runDists:["Mile / 1600m"]}
};

// Phase data â€” start dates drive auto-advancement
const PHASES = {
  "Xavier + Gabby":{color:"#e91e8c",totalWeeks:6,start:new Date("2026-02-08"),
    weeks:[
      {wk:1,theme:"Establish",upper:"60-65%",lower:"60-65%",vmax:"Box Jump 3x6, Power Skip 3x8",note:"Set sprint baselines",
       sprint:{dists:["100m","200m"],reps:2,rest:"Full (3-4 min)",target:"Baseline â€” just log times, no pressure"}},
      {wk:2,theme:"Establish",upper:"60-65%",lower:"60-65%",vmax:"Raptor â€” Resisted Sprint 10yd 4x4",note:"Normal progression",
       sprint:{dists:["100m","200m"],reps:3,rest:"Full (3-4 min)",target:"Beat baseline times from Week 1"}},
      {wk:3,theme:"Sharpen",upper:"65-70%",lower:"62-67%",vmax:"Raptor â€” Bound 3x6, Box Jump 3x8",note:"Bump bench/OHP slightly",
       sprint:{dists:["200m","300m"],reps:3,rest:"Full (4-5 min)",target:"Xavier <29.5 / Gabby sub-baseline+1sec"}},
      {wk:4,theme:"Sharpen",upper:"65-70%",lower:"60-65%",vmax:"Raptor â€” Resisted 20yd 4x4, Broad Jump 3x5",note:"Hold lower flat",
       sprint:{dists:["100m","400m"],reps:3,rest:"3 min between 100s, full before 400",target:"100m max effort / 400m at tempo pace"}},
      {wk:5,theme:"Taper",upper:"60-65%",lower:"55-60%",vmax:"Light â€” Ankle Stiff 3x10, Power Skip 2x6",note:"Reduce sets â€” protect legs",
       sprint:{dists:["40yd","60m"],reps:3,rest:"Full â€” quality over quantity",target:"Max effort sharpening â€” race pace"}},
      {wk:6,theme:"PEAK",upper:"55-60%",lower:"50-55%",vmax:"2-3 drills only, light band",note:"Lift only if not race day",
       sprint:{dists:["60m"],reps:2,rest:"Full",target:"Shakeout only â€” save everything for race"}}
    ]},
  "Joey":{color:"#00b4d8",totalWeeks:10,start:new Date("2026-02-22"),
    weeks:[
      {wk:1,theme:"Base",upper:"65%",lower:"65-70%",vmax:"â€”",note:"Build consistency, log every set"},
      {wk:2,theme:"Base",upper:"67%",lower:"67-72%",vmax:"â€”",note:"Small weight jumps only"},
      {wk:3,theme:"Base",upper:"70%",lower:"70-75%",vmax:"â€”",note:"Test unassisted pull-ups this week"},
      {wk:4,theme:"Accum",upper:"72-75%",lower:"72-77%",vmax:"â€”",note:"Push weight â€” small jumps each session"},
      {wk:5,theme:"Accum",upper:"75-78%",lower:"75-80%",vmax:"â€”",note:"Rep PRs expected this week"},
      {wk:6,theme:"Accum",upper:"78-80%",lower:"80-85%",vmax:"â€”",note:"Deadlift focus â€” push hard"},
      {wk:7,theme:"Peak",upper:"80-82%",lower:"83-88%",vmax:"â€”",note:"Bench PR attempt"},
      {wk:8,theme:"Peak",upper:"82-85%",lower:"85-90%",vmax:"â€”",note:"Squat PR attempt"},
      {wk:9,theme:"Peak",upper:"85%+",lower:"88-92%",vmax:"â€”",note:"Deadlift max test"},
      {wk:10,theme:"DELOAD",upper:"50-55%",lower:"50-55%",vmax:"â€”",note:"Retest all lifts â€” log final PRs"}
    ]},
  "Vera":{color:"#2ecc71",totalWeeks:10,start:new Date("2026-02-22"),
    weeks:[
      {wk:1,theme:"Base",upper:"65%",lower:"65%",vmax:"Rotational throw 4x6",note:"Full health â€” establish all baselines"},
      {wk:2,theme:"Base",upper:"67%",lower:"67%",vmax:"Rotational throw 4x6, Power Skip 3x8",note:"Small weight jumps"},
      {wk:3,theme:"Base",upper:"70%",lower:"70%",vmax:"Rotational throw 4x8, Box Jump 3x6",note:"Progress OHP to 20s this week"},
      {wk:4,theme:"Accum",upper:"72-75%",lower:"72%",vmax:"Rotational throw 4x8, Bound 3x6",note:"Bench PR attempt â€” she is strong"},
      {wk:5,theme:"Accum",upper:"75%",lower:"75%",vmax:"Med Ball Slam 3x8, Rotational throw 4x8",note:"Push lower â€” DL and squat"},
      {wk:6,theme:"Accum",upper:"78%",lower:"78%",vmax:"Rotational throw 5x6 heavy",note:"Power focus â€” discus carryover"},
      {wk:7,theme:"Peak",upper:"80%",lower:"80%",vmax:"Full power circuit",note:"Bench + DL PR attempts"},
      {wk:8,theme:"Peak",upper:"82%",lower:"82%",vmax:"Full power circuit",note:"Squat PR attempt"},
      {wk:9,theme:"Peak",upper:"85%",lower:"83%",vmax:"â€”",note:"Max strength test week"},
      {wk:10,theme:"DELOAD",upper:"50-55%",lower:"50-55%",vmax:"Light throws only",note:"Retest all lifts â€” log final PRs"}
    ]}
};

const APPS_SCRIPT_CODE = `function doPost(e){
  try{
    var data=JSON.parse(e.postData.contents);
    return handle(data);
  }catch(err){return out({status:"error",message:err.toString()});}
}
function doGet(e){
  if(e.parameter&&e.parameter.payload)
    return handle(JSON.parse(e.parameter.payload));
  return out({status:"ok",message:"HoH API running"});
}
function handle(data){
  var ss=SpreadsheetApp.getActiveSpreadsheet();
  if(data.type==="session") logSession(ss,data);
  else if(data.type==="pr") logPR(ss,data);
  else if(data.type==="ping") logPing(ss);
  return out({status:"ok"});
}
function out(o){
  return ContentService.createTextOutput(JSON.stringify(o))
    .setMimeType(ContentService.MimeType.JSON);
}
function logPing(ss){
  var sh=ss.getSheetByName("Sync Log")||ss.insertSheet("Sync Log");
  if(sh.getLastRow()===0){sh.appendRow(["Timestamp","Event"]);sh.getRange(1,1,1,2).setFontWeight("bold");}
  sh.appendRow([new Date().toLocaleString(),"Ping from HoH app"]);
}
function logSession(ss,data){
  var sh=ss.getSheetByName("Sessions");
  if(!sh){sh=ss.insertSheet("Sessions");var h=["Date","Session","Athletes","Athlete","Day","Lift","Set","Weight","Reps","Notes"];sh.appendRow(h);sh.getRange(1,1,1,h.length).setFontWeight("bold").setBackground("#1a2744").setFontColor("#ffffff");}
  (data.rows||[]).forEach(function(r){sh.appendRow([r.date,r.session,r.athletes,r.athlete,r.day,r.lift,r.set,r.weight,r.reps,r.notes||""]);});
}
function logPR(ss,data){
  var sh=ss.getSheetByName("PRs");
  if(!sh){sh=ss.insertSheet("PRs");var h=["Date","Athlete","Lift","New PR","Previous PR","Unit","Notes"];sh.appendRow(h);sh.getRange(1,1,1,h.length).setFontWeight("bold").setBackground("#1a2744").setFontColor("#ffffff");}
  sh.appendRow([data.date,data.athlete,data.lift,data.newVal,data.oldVal,data.unit,data.notes||""]);
}`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let curSess=null, activeAth=null, sessLogs={}, sessNotes="";
let curModal=null, editTarget=null;
let sheetsURL=localStorage.getItem("hoh_url")||"";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function go(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(id==="s-home") renderHome();
  if(id==="s-athletes") renderAthletes();
  if(id==="s-lb") renderLB();
  if(id==="s-phase") renderPhase();
  if(id==="s-settings") renderSettings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHome(){
  const now=new Date();
  document.getElementById("h-date").textContent=now.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});
  document.getElementById("h-day").textContent=now.toLocaleDateString("en-US",{weekday:"long"});
  const saved=getSaved();
  let prCount=0; Object.values(ATH).forEach(a=>{prCount+=a.hist.length;});
  document.getElementById("h-stats").innerHTML=`
    <div class="qc"><div class="qn">4</div><div class="ql">Athletes</div></div>
    <div class="qc"><div class="qn">${prCount}</div><div class="ql">PRs</div></div>
    <div class="qc"><div class="qn">${saved.length}</div><div class="ql">Sessions</div></div>`;
  const el=document.getElementById("h-recent");
  if(!saved.length){el.innerHTML=`<div style="text-align:center;color:var(--muted);padding:20px;font-size:13px;">No sessions yet â€” start one above â†‘</div>`;return;}
  el.innerHTML=saved.slice(0,20).map((s,i)=>`
    <div class="card" style="padding:12px 16px;margin-bottom:8px;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
        <div style="flex:1;min-width:0;cursor:pointer;" onclick="openEdit(${i})">
          <div style="font-weight:600;font-size:14px;">${s.label}</div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px;">${s.date} Â· ${s.athletes}</div>
          ${s.notes?`<div style="font-size:11px;color:var(--muted);margin-top:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:180px;">${s.notes}</div>`:""}
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;flex-shrink:0;">
          <div style="font-size:11px;color:var(--muted);text-align:right;">${s.setsLogged} sets<br>${s.synced?"<span style='color:var(--green)'>âœ“ synced</span>":"<span style='color:var(--muted)'>local</span>"}</div>
          <div style="display:flex;gap:6px;">
            <button onclick="openEdit(${i})" style="background:rgba(232,168,56,0.12);border:1px solid rgba(232,168,56,0.3);color:var(--accent);border-radius:6px;padding:4px 10px;font-size:11px;font-weight:700;cursor:pointer;">EDIT</button>
            <button onclick="delSess(${i})" style="background:rgba(231,76,60,0.12);border:1px solid rgba(231,76,60,0.3);color:var(--red);border-radius:6px;padding:4px 10px;font-size:11px;font-weight:700;cursor:pointer;">DEL</button>
          </div>
        </div>
      </div>
    </div>`).join("");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ATHLETES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAthletes(){
  document.getElementById("ath-list").innerHTML=Object.entries(ATH).map(([name,a])=>`
    <div class="ath-card" onclick="showAth('${name}')">
      <div class="avatar" style="background:${a.bg};border-color:${a.color};color:${a.color}">${name[0]}</div>
      <div style="flex:1;min-width:0;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;color:${a.color}">${name}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:2px;">${a.age} Â· ${a.school}</div>
        <div style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap;">
          <span class="tag" style="background:${a.bg};color:${a.color}">Sess ${a.sess}</span>
          <span class="tag">${a.status}</span>
        </div>
      </div>
      <div style="color:var(--muted);font-size:20px;">â€º</div>
    </div>`).join("");
}

function showAth(name){
  const a=ATH[name];
  document.getElementById("d-name").textContent=name;
  document.getElementById("d-sport").textContent=a.sport;
  const prKeys=Object.keys(a.prs).slice(0,6);
  document.getElementById("d-prs").innerHTML=prKeys.map(k=>`
    <div class="pr-mini">
      <div class="pr-mini-label">${k}</div>
      <div class="pr-mini-val" style="color:${a.color}">${a.prs[k].v}</div>
      <div style="font-size:10px;color:var(--muted);margin-top:2px;">${a.prs[k].d}</div>
    </div>`).join("");
  document.getElementById("d-update").innerHTML=Object.keys(a.prs).map(k=>`
    <div class="sprint-row">
      <div style="flex:1;font-size:13px;font-weight:600;">${k}</div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:13px;color:${a.color};margin-right:10px;">${a.prs[k].v}</div>
      <button onclick="promptPR('${name}','${k}')" style="background:${a.bg};border:1px solid ${a.color};color:${a.color};border-radius:8px;padding:6px 12px;font-size:12px;font-weight:700;cursor:pointer;">UPDATE</button>
    </div>`).join("");
  document.getElementById("d-hist").innerHTML=a.hist.length
    ?a.hist.map(h=>`<div class="hist-row"><div style="font-size:11px;color:var(--muted);width:65px;flex-shrink:0;">${h.d}</div><div style="flex:1;font-size:13px;font-weight:600;">${h.l}</div><div style="font-family:'JetBrains Mono',monospace;font-size:14px;color:${a.color};">${h.v}</div></div>`).join("")
    :`<div style="color:var(--muted);font-size:13px;text-align:center;padding:16px;">No history yet</div>`;
  go("s-ath-detail");
}

function promptPR(name,lift){
  const a=ATH[name];
  curModal={type:"pr",name,lift};
  document.getElementById("m-title").textContent=`Update â€” ${lift}`;
  document.getElementById("m-sub").textContent=`${name} Â· Current: ${a.prs[lift].v} ${a.prs[lift].u}`;
  document.getElementById("m-l1").textContent=TIMED.has(lift)?"Time":"Value";
  document.getElementById("m-l2").textContent="Date (opt)";
  document.getElementById("m-w").type=TIMED.has(lift)?"text":"number";
  document.getElementById("m-w").value="";
  document.getElementById("m-r").value="";
  document.getElementById("modal").classList.add("show");
  setTimeout(()=>document.getElementById("m-w").focus(),300);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LEADERBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLB(){
  const cats=["Bench Press","Squat","Deadlift","Overhead Press","Hack Squat","Pull-Ups","Mile Time","200m"];
  document.getElementById("lb-content").innerHTML=cats.map(cat=>{
    const isLo=TIMED.has(cat);
    const entries=Object.entries(ATH)
      .filter(([,a])=>a.prs[cat]&&a.prs[cat].v!==undefined)
      .map(([name,a])=>({name,v:a.prs[cat].v,color:a.color}))
      .sort((a,b)=>{const av=parseT(a.v),bv=parseT(b.v);return isLo?av-bv:bv-av;});
    const medals=["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];
    return `<div class="lb-sec">
      <div class="lb-hdr">${isLo?"â±":"ğŸ‹ï¸"} ${cat}</div>
      ${entries.map((e,i)=>`<div class="lb-row ${i<3?"r"+(i+1):""}">
        <div class="lb-rank">${medals[i]||i+1}</div>
        <div class="lb-name" style="color:${e.color}">${e.name}</div>
        <div class="lb-val">${e.v}</div>
      </div>`).join("")}
    </div>`;
  }).join("");
}
function parseT(v){const s=String(v);if(s.includes(":")){const p=s.split(":");return parseFloat(p[0])*60+parseFloat(p[1]);}return parseFloat(s)||0;}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PHASE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function curWeek(p){
  const ms=7*24*60*60*1000;
  const wk=Math.floor((new Date()-p.start)/ms)+1;
  return Math.max(1,Math.min(wk,p.totalWeeks));
}

function renderPhase(){
  let html="";

  // â”€â”€ Xavier + Gabby â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const xg=PHASES["Xavier + Gabby"],xgW=curWeek(xg),xgPct=Math.round((xgW-1)/xg.totalWeeks*100),xgCur=xg.weeks[xgW-1];
  html+=phaseCard("Xavier + Gabby",xg,xgW,xgPct);
  if(xgCur){
    html+=`<div class="wk-detail" style="border-color:rgba(233,30,140,0.25);">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:1.5px;color:#e91e8c;margin-bottom:10px;">ğŸ“‹ WEEK ${xgCur.wk} â€” ${xgCur.theme}</div>
      <div class="wk-row"><div class="wk-label">Upper</div><div class="wk-val" style="color:#e91e8c;font-family:'JetBrains Mono',monospace;">${xgCur.upper}</div></div>
      <div class="wk-row"><div class="wk-label">Lower</div><div class="wk-val" style="color:#e91e8c;font-family:'JetBrains Mono',monospace;">${xgCur.lower}</div></div>
      <div class="wk-row"><div class="wk-label">Vertimax</div><div class="wk-val">${xgCur.vmax}</div></div>
      ${xgCur.sprint?`<div class="wk-row" style="align-items:flex-start;"><div class="wk-label">Sprint Workout</div><div class="wk-val"><span style="color:var(--accent);font-weight:700;">${xgCur.sprint.dists.join(" + ")}</span><br><span style="font-size:11px;color:var(--muted);">${xgCur.sprint.reps} reps each Â· ${xgCur.sprint.rest}</span><br><span style="font-size:11px;color:var(--text);">${xgCur.sprint.target}</span></div></div>`:""}
      <div class="wk-row"><div class="wk-label">Note</div><div class="wk-val" style="color:var(--accent);">${xgCur.note}</div></div>
    </div>`;
  }

  // â”€â”€ Joey + Vera side by side â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const jp=PHASES["Joey"],vp=PHASES["Vera"];
  const jW=curWeek(jp),vW=curWeek(vp);
  const jPct=Math.round((jW-1)/jp.totalWeeks*100),vPct=Math.round((vW-1)/vp.totalWeeks*100);
  const jCur=jp.weeks[jW-1],vCur=vp.weeks[vW-1];

  // Combined progress card
  html+=`<div class="phase-card" style="border-color:rgba(0,180,216,0.2);margin-top:8px;">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:1.5px;color:#00b4d8">Joey</div>
        <div style="font-size:11px;color:var(--muted);margin-bottom:8px;">Wk ${jW} of ${jp.totalWeeks} Â· ${jCur?jCur.theme:''}</div>
        <div style="height:5px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;"><div style="height:100%;width:${jPct}%;background:#00b4d8;border-radius:3px;"></div></div>
        <div style="display:flex;gap:4px;margin-top:8px;flex-wrap:wrap;">${jp.weeks.map((w,i)=>`<div class="wk-dot ${i<jW-1?"done":""} ${i===jW-1?"cur":""}" onclick="wkAlert('Joey',${i})" style="width:26px;height:26px;font-size:12px;">${w.wk}</div>`).join("")}</div>
      </div>
      <div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:1.5px;color:#2ecc71">Vera</div>
        <div style="font-size:11px;color:var(--muted);margin-bottom:8px;">Wk ${vW} of ${vp.totalWeeks} Â· ${vCur?vCur.theme:''}</div>
        <div style="height:5px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;"><div style="height:100%;width:${vPct}%;background:#2ecc71;border-radius:3px;"></div></div>
        <div style="display:flex;gap:4px;margin-top:8px;flex-wrap:wrap;">${vp.weeks.map((w,i)=>`<div class="wk-dot ${i<vW-1?"done":""} ${i===vW-1?"cur":""}" onclick="wkAlert('Vera',${i})" style="width:26px;height:26px;font-size:12px;">${w.wk}</div>`).join("")}</div>
      </div>
    </div>
  </div>`;

  // Joey + Vera current week side by side detail
  if(jCur && vCur){
    html+=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;">
      <div class="wk-detail" style="border-color:rgba(0,180,216,0.3);">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1px;color:#00b4d8;margin-bottom:8px;">ğŸ’ª Joey â€” Wk ${jW}</div>
        <div class="wk-row"><div class="wk-label">Upper</div><div class="wk-val" style="color:#00b4d8;">${jCur.upper}</div></div>
        <div class="wk-row"><div class="wk-label">Lower</div><div class="wk-val" style="color:#00b4d8;">${jCur.lower}</div></div>
        <div class="wk-row"><div class="wk-label">Focus</div><div class="wk-val">${jCur.note}</div></div>
      </div>
      <div class="wk-detail" style="border-color:rgba(46,204,113,0.3);">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1px;color:#2ecc71;margin-bottom:8px;">ğŸ¥ Vera â€” Wk ${vW}</div>
        <div class="wk-row"><div class="wk-label">Upper</div><div class="wk-val" style="color:#2ecc71;">${vCur.upper}</div></div>
        <div class="wk-row"><div class="wk-label">Lower</div><div class="wk-val" style="color:#2ecc71;">${vCur.lower}</div></div>
        <div class="wk-row"><div class="wk-label">Vertimax</div><div class="wk-val">${vCur.vmax}</div></div>
      </div>
    </div>`;
  }

  document.getElementById("phase-content").innerHTML=html;
}

function phaseCard(group,p,cw,pct){
  return `<div class="phase-card">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;">
      <div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;color:${p.color}">${group}</div>
        <div style="font-size:12px;color:var(--muted);margin-top:3px;">${p.totalWeeks}-Week Block Â· <span style="color:${p.color};font-weight:700;">Week ${cw}</span> Â· Auto-advances weekly</div>
      </div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:600;color:${p.color}">${pct}%</div>
    </div>
    <div class="phase-prog"><div class="phase-bar" style="width:${pct}%;background:${p.color}"></div></div>
    <div class="wk-dots">${p.weeks.map((w,i)=>`<div class="wk-dot ${i<cw-1?"done":""} ${i===cw-1?"cur":""}" onclick="wkAlert('${group}',${i})">${w.wk}</div>`).join("")}</div>
  </div>`;
}

function wkAlert(group,idx){
  const p=PHASES[group],w=p.weeks[idx],cw=curWeek(p);
  const status=idx<cw-1?"âœ… Complete":idx===cw-1?"ğŸ“ Current":"ğŸ”’ Upcoming";
  let msg=`${status}
Week ${w.wk} â€” ${w.theme}

Upper: ${w.upper}
Lower: ${w.lower}
Vertimax: ${w.vmax}
Note: ${w.note}`;
  if(w.sprint) msg+=`

Sprint Workout:
${w.sprint.dists.join(" + ")} Â· ${w.sprint.reps} reps
Rest: ${w.sprint.rest}
Target: ${w.sprint.target}`;
  alert(msg);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SESSION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startSession(type){
  const sd=SESS[type];
  curSess={type,sd,day:1};
  sessLogs={}; sessNotes="";
  sd.athletes.forEach(a=>{sessLogs[a]={};});
  sessLogs._shared={};
  activeAth=sd.athletes[0];
  document.getElementById("sess-title").textContent=sd.label;
  document.getElementById("sess-date").textContent=new Date().toLocaleDateString("en-US",{month:"short",day:"numeric"});
  renderSess();
  go("s-session");
}

function switchAth(name){activeAth=name;renderSess();document.getElementById("sess-content").scrollTop=0;}
function switchDay(d){curSess.day=d;renderSess();}
function cntSets(name){return Object.values(sessLogs[name]||{}).filter(v=>v&&(v.w||v.r||v.name)).length;}

function renderSess(){
  const {sd,day}=curSess;
  const isShared=sd.athletes.length>1;
  const lifts=day===1?sd.day1:sd.day2;
  let html="";

  // Athlete switcher
  if(isShared){
    html+=`<div class="switcher">`;
    sd.athletes.forEach(name=>{
      const a=ATH[name], isAct=activeAth===name, cnt=cntSets(name);
      html+=`<div class="sw-btn ${isAct?"active-a":""}" style="${isAct?`background:${a.color};`:`color:${a.color};`}" onclick="switchAth('${name}')">${name}<div class="sw-sub">${cnt} sets</div></div>`;
    });
    html+=`</div>`;
  }

  // Active athlete banner
  const cA=ATH[activeAth];
  html+=`<div style="background:${cA.bg};border:1px solid ${cA.color}40;border-radius:10px;padding:10px 14px;margin-bottom:14px;display:flex;align-items:center;gap:10px;">
    <div style="width:34px;height:34px;border-radius:50%;background:${cA.color}25;border:1px solid ${cA.color};display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:16px;color:${cA.color}">${activeAth[0]}</div>
    <div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:${cA.color}">Logging for ${activeAth}</div>
      <div style="font-size:11px;color:var(--muted);">${isShared?"Tap name above to switch":""}</div>
    </div>
  </div>`;

  // Day toggle
  html+=`<div class="day-toggle">
    <div class="day-btn ${day===1?"active":""}" onclick="switchDay(1)">Day 1 â€” Upper</div>
    <div class="day-btn ${day===2?"active":""}" onclick="switchDay(2)">Day 2 â€” Lower</div>
  </div>`;

  // Lifts
  lifts.forEach((lift,li)=>{
    const nSets=parseInt(lift.s.split("x")[0])||5;
    const lk=`d${day}_${li}`;
    const aLog=sessLogs[activeAth]||{};
    html+=`<div class="lift-block">
      <div class="lift-name">${lift.n}<span class="lift-scheme">${lift.s}</span><span class="lift-pct">${lift.p}</span></div>
      <div class="sets-grid">${Array.from({length:nSets},(_,si)=>{
        const k=`${lk}_s${si}`, log=aLog[k];
        return `<div class="set-box ${log?"done":""}" onclick="openSetModal('${lift.n}','${lk}',${si})">
          <div class="set-num">S${si+1}</div><div class="set-val">${log?log.w+"x"+log.r:"â€”"}</div>
        </div>`;
      }).join("")}</div>
    </div>`;
  });

  // Extra lifts
  html+=`<div class="divider">Extra Lifts</div>`;
  for(let ex=0;ex<3;ex++){
    const k=`d${day}_ex${ex}`,log=(sessLogs[activeAth]||{})[k];
    html+=`<div class="sprint-row">
      <input class="srinput" style="width:110px;text-align:left;" placeholder="Exercise" id="en_${activeAth}_${k}" value="${log?.name||""}" onchange="logExtra('${k}')">
      <input class="srinput" placeholder="lbs x reps" id="ev_${activeAth}_${k}" value="${log?.val||""}" onchange="logExtra('${k}')">
    </div>`;
  }

  // Vertimax
  if(sd.vmax&&sd.vmax.length>0){
    html+=`<div class="divider">âš¡ Vertimax Drills</div>`;
    sd.vmax.forEach((drill,di)=>{
      const k=`vmax${di}`,log=sessLogs._shared[k]||{};
      html+=`<div class="vrow">
        <div style="flex:1;font-size:13px;font-weight:500;">${drill}</div>
        <input class="vinput" placeholder="sets" value="${log.sets||""}" onchange="logSh('${k}','sets',this.value)">
        <input class="vinput" placeholder="reps" value="${log.reps||""}" onchange="logSh('${k}','reps',this.value)">
        <input class="vinput" style="width:50px;" placeholder="band" value="${log.band||""}" onchange="logSh('${k}','band',this.value)">
      </div>`;
    });
  }

  // Sprint section (Session A only â€” rep by rep)
  if(sd.hasSprint){
    const ph=PHASES["Xavier + Gabby"],wkN=curWeek(ph),wkD=ph.weeks[wkN-1],sw=wkD?.sprint;
    html+=`<div class="divider">ğŸƒ Sprint Workout</div>`;
    if(sw){
      html+=`<div class="prescription-box" style="background:rgba(233,30,140,0.08);border:1px solid rgba(233,30,140,0.25);">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:1.5px;color:var(--pink);margin-bottom:4px;">WEEK ${wkN} PRESCRIPTION â€” ${wkD.theme}</div>
        <div style="font-size:13px;font-weight:600;">${sw.dists.join(" + ")} Â· ${sw.reps} reps each</div>
        <div style="font-size:11px;color:var(--muted);margin-top:3px;">Rest: ${sw.rest}</div>
        <div style="font-size:11px;color:var(--accent);margin-top:2px;">Target: ${sw.target}</div>
      </div>`;
    }

    sd.athletes.forEach(athName=>{
      const a=ATH[athName];
      const dists=sw?sw.dists:["100m","200m"];
      const nReps=sw?sw.reps:3;
      html+=`<div style="margin-bottom:16px;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1px;color:${a.color};margin-bottom:8px;">${athName}</div>`;
      dists.forEach(dist=>{
        html+=`<div style="margin-bottom:10px;">
          <div style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:6px;">${dist}</div>
          <div class="rep-grid">`;
        for(let rep=0;rep<nReps;rep++){
          const k=`spr_${athName}_${dist}_${rep}`,log=sessLogs._shared[k]||{};
          html+=`<div class="rep-box">
            <div style="font-size:9px;color:var(--muted);">REP ${rep+1}</div>
            <input style="color:${a.color};" placeholder="0:00" value="${log.val||""}" onchange="logSh('${k}','val',this.value)">
          </div>`;
        }
        html+=`</div></div>`;
      });
      // Custom distance row
      const ck=`spr_${athName}_custom`,cl=sessLogs._shared[ck]||{};
      html+=`<div class="sprint-row" style="margin-top:4px;">
        <input class="srinput" style="width:100px;text-align:left;color:var(--muted);" placeholder="+ distance" id="cd_${athName}" value="${cl.dist||""}" onchange="logCustom('${athName}')">
        <input class="srinput" style="color:${a.color};" placeholder="time" id="ct_${athName}" value="${cl.val||""}" onchange="logCustom('${athName}')">
      </div></div>`;
    });

  } else if(sd.runDists&&sd.runDists.length>0){
    // Non-sprint sessions â€” simple run time
    html+=`<div class="divider">â± Run Times</div>`;
    sd.runDists.forEach(dist=>{
      const k=`run_${dist}`,log=sessLogs._shared[k]||{};
      html+=`<div class="sprint-row">
        <div style="flex:1;font-size:13px;font-weight:600;">${dist}</div>
        <input class="srinput" placeholder="time" value="${log.val||""}" onchange="logSh('${k}','val',this.value)">
      </div>`;
    });
  }

  // Notes + save
  html+=`<div class="divider">ğŸ“ Coach Notes</div>
    <textarea class="notes-area" placeholder="Form cues, energy, injuries, anything worth notingâ€¦" onchange="sessNotes=this.value">${sessNotes}</textarea>
    <div style="margin-top:20px;"><button class="save-btn" onclick="saveSess()">âœ“ SAVE SESSION</button></div>`;

  document.getElementById("sess-content").innerHTML=html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSetModal(liftName,lk,si){
  const k=`${lk}_s${si}`, ex=(sessLogs[activeAth]||{})[k];
  curModal={type:"set",lk,si,liftName,k};
  document.getElementById("m-title").textContent=liftName;
  document.getElementById("m-sub").textContent=`${activeAth} Â· Set ${si+1}`;
  document.getElementById("m-l1").textContent="Weight (lbs)";
  document.getElementById("m-l2").textContent="Reps";
  document.getElementById("m-w").type="number";
  document.getElementById("m-w").value=ex?.w||"";
  document.getElementById("m-r").value=ex?.r||"";
  document.getElementById("modal").classList.add("show");
  setTimeout(()=>document.getElementById("m-w").focus(),300);
}

function saveModal(){
  const m=curModal; if(!m) return;
  if(m.type==="set"){
    const w=document.getElementById("m-w").value, r=document.getElementById("m-r").value;
    if(!w&&!r){closeModal();return;}
    if(!sessLogs[activeAth]) sessLogs[activeAth]={};
    sessLogs[activeAth][m.k]={w:w||"BW",r:r||"â€”"};
    checkPR(m.liftName,w,activeAth);
    closeModal(); renderSess();
  } else if(m.type==="editSet"){
    const w=document.getElementById("m-w").value, r=document.getElementById("m-r").value;
    if(editTarget!==null){
      const saved=getSaved();
      const row=saved[editTarget.si].rows[editTarget.ri];
      if(w) row.weight=w; if(r) row.reps=r;
      try{localStorage.setItem("hoh_sessions",JSON.stringify(saved));}catch(e){}
      closeModal();
      openEdit(editTarget.si); editTarget=null;
    }
  } else if(m.type==="pr"){
    const newV=document.getElementById("m-w").value, dateV=document.getElementById("m-r").value;
    if(!newV){closeModal();return;}
    const a=ATH[m.name], old=a.prs[m.lift].v;
    const today=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"});
    a.prs[m.lift].v=TIMED.has(m.lift)?newV:parseFloat(newV)||newV;
    a.prs[m.lift].d=dateV||today;
    a.hist.unshift({d:a.prs[m.lift].d,l:m.lift,v:`${newV} ${a.prs[m.lift].u}`,n:`Updated from ${old}`});
    syncPR(m.name,m.lift,newV,old,a.prs[m.lift].u);
    toast(`â­ ${m.name} â€” ${m.lift}: ${newV}`);
    closeModal(); showAth(m.name);
  }
}

function checkPR(liftName,weight,name){
  const a=ATH[name]; if(!a||!a.prs[liftName]) return;
  const w=parseFloat(weight); if(isNaN(w)) return;
  const cur=parseFloat(a.prs[liftName].v);
  if(w>cur){
    const old=a.prs[liftName].v;
    const today=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"});
    a.prs[liftName].v=w; a.prs[liftName].d=today;
    a.hist.unshift({d:today,l:liftName,v:`${w} lbs`,n:`Session PR (was ${old})`});
    syncPR(name,liftName,w,old,a.prs[liftName].u);
    toast(`ğŸ”¥ ${name} PR â€” ${liftName}: ${w} lbs!`);
  }
}

function closeModalOv(e){if(e.target.id==="modal") closeModal();}
function closeModal(){document.getElementById("modal").classList.remove("show");curModal=null;}
document.addEventListener("keydown",e=>{if(e.key==="Enter"&&document.getElementById("modal").classList.contains("show")) saveModal();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOGGING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function logExtra(k){
  const name=document.getElementById(`en_${activeAth}_${k}`)?.value;
  const val=document.getElementById(`ev_${activeAth}_${k}`)?.value;
  if(!sessLogs[activeAth]) sessLogs[activeAth]={};
  sessLogs[activeAth][k]={name,val};
}
function logSh(k,field,val){if(!sessLogs._shared[k]) sessLogs._shared[k]={};sessLogs._shared[k][field]=val;}
function logCustom(name){
  const dist=document.getElementById(`cd_${name}`)?.value;
  const time=document.getElementById(`ct_${name}`)?.value;
  sessLogs._shared[`spr_${name}_custom`]={dist,val:time};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SAVE SESSION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveSess(){
  const {sd}=curSess;
  const today=new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});
  let totalSets=0; const rows=[];
  sd.athletes.forEach(name=>{
    Object.entries(sessLogs[name]||{}).forEach(([k,v])=>{
      if(!v||(!v.w&&!v.r&&!v.name)) return;
      totalSets++;
      const parts=k.split("_"); const dayN=parts[0]; const liftIdx=parseInt(parts[1]);
      const lifts=dayN==="d1"?sd.day1:sd.day2;
      const liftName=lifts[liftIdx]?.n||parts[1];
      const setNum=parts[2]?.replace("s","")||"";
      rows.push({date:today,session:sd.label,athletes:sd.athletes.join("+"),athlete:name,day:dayN,lift:liftName,set:setNum,weight:v.w||v.name||"",reps:v.r||v.val||"",notes:sessNotes});
    });
  });
  const rec={label:sd.label,date:today,athletes:sd.athletes.join(" + "),setsLogged:totalSets,notes:sessNotes,synced:false,rows};
  const saved=getSaved(); saved.unshift(rec);
  try{localStorage.setItem("hoh_sessions",JSON.stringify(saved.slice(0,50)));}catch(e){}
  syncSession(rec);
  curSess=null; sessLogs={}; go("s-home");
  setTimeout(()=>toast("âœ“ Session Saved!"),200);
}

function leaveSession(){
  const hasData=Object.values(sessLogs).some(v=>typeof v==="object"&&Object.keys(v).length>0);
  if(hasData&&!confirm("Leave? Unsaved data will be lost.")) return;
  curSess=null; sessLogs={}; go("s-home");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EDIT SESSION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openEdit(idx){
  const saved=getSaved(), s=saved[idx];
  if(!s){toast("Session not found");return;}
  document.getElementById("edit-title").textContent=s.label;
  document.getElementById("edit-date").textContent=s.date;
  renderEdit(idx);
  go("s-edit");
}

function renderEdit(idx){
  const saved=getSaved(), s=saved[idx];
  let html=`<div class="card" style="margin-bottom:14px;">
    <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:1.5px;">${s.label}</div>
    <div style="font-size:12px;color:var(--muted);">${s.date} Â· ${s.athletes} Â· ${s.setsLogged} sets</div>
  </div>
  <div style="font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;color:var(--muted);margin-bottom:8px;">COACH NOTES</div>
  <textarea class="notes-area" id="edit-notes-${idx}" style="margin-bottom:16px;">${s.notes||""}</textarea>
  <div style="font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;color:var(--muted);margin-bottom:8px;">LOGGED SETS</div>`;

  if(s.rows&&s.rows.length>0){
    const byAth={};
    s.rows.forEach(r=>{if(!byAth[r.athlete]) byAth[r.athlete]=[];byAth[r.athlete].push(r);});
    Object.entries(byAth).forEach(([name,rows])=>{
      const a=ATH[name]||{color:"var(--accent)",bg:"rgba(232,168,56,0.1)"};
      const byLift={};
      rows.forEach(r=>{const k=r.day+"â€”"+r.lift;if(!byLift[k]) byLift[k]=[];byLift[k].push({...r,globalIdx:s.rows.indexOf(r)});});
      html+=`<div style="background:${a.bg};border:1px solid ${a.color}30;border-radius:10px;padding:12px;margin-bottom:12px;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:${a.color};margin-bottom:10px;">${name}</div>`;
      Object.entries(byLift).forEach(([lk,lrows])=>{
        html+=`<div style="margin-bottom:10px;">
          <div style="font-size:12px;font-weight:600;margin-bottom:6px;">${lk}</div>
          <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;">`;
        lrows.forEach((r,si)=>{
          html+=`<div style="background:rgba(46,204,113,0.08);border:1px solid rgba(46,204,113,0.3);border-radius:8px;padding:6px 4px;text-align:center;cursor:pointer;" onclick="editSet(${idx},${r.globalIdx})">
            <div style="font-size:9px;color:var(--muted);">S${si+1}</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;margin-top:2px;">${r.weight}x${r.reps}</div>
          </div>`;
        });
        html+=`</div></div>`;
      });
      html+=`</div>`;
    });
  } else {
    html+=`<div style="color:var(--muted);font-size:13px;text-align:center;padding:16px;">No set data stored</div>`;
  }

  html+=`<div style="display:flex;gap:10px;margin-top:20px;">
    <button onclick="saveEdit(${idx})" class="save-btn" style="flex:1;font-size:17px;">SAVE CHANGES</button>
    <button onclick="delSess(${idx})" style="padding:16px 20px;background:rgba(231,76,60,0.12);border:1px solid rgba(231,76,60,0.3);border-radius:12px;font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:2px;color:var(--red);cursor:pointer;">DEL</button>
  </div>`;
  document.getElementById("edit-content").innerHTML=html;
}

function editSet(sessIdx,rowIdx){
  const s=getSaved()[sessIdx];
  const row=s.rows[rowIdx];
  editTarget={si:sessIdx,ri:rowIdx};
  curModal={type:"editSet"};
  document.getElementById("m-title").textContent=row.lift;
  document.getElementById("m-sub").textContent=`${row.athlete} Â· Edit set`;
  document.getElementById("m-l1").textContent="Weight (lbs)";
  document.getElementById("m-l2").textContent="Reps";
  document.getElementById("m-w").type="number";
  document.getElementById("m-w").value=row.weight||"";
  document.getElementById("m-r").value=row.reps||"";
  document.getElementById("modal").classList.add("show");
  setTimeout(()=>document.getElementById("m-w").focus(),300);
}

function saveEdit(idx){
  const saved=getSaved();
  const notes=document.getElementById(`edit-notes-${idx}`)?.value||"";
  saved[idx].notes=notes;
  try{localStorage.setItem("hoh_sessions",JSON.stringify(saved));}catch(e){}
  syncSession(saved[idx]);
  toast("âœ“ Session updated");
  go("s-home");
}

function delSess(idx){
  if(!confirm("Delete this session?")) return;
  const saved=getSaved(); saved.splice(idx,1);
  try{localStorage.setItem("hoh_sessions",JSON.stringify(saved));}catch(e){}
  toast("Session deleted"); go("s-home");
}

function clearAll(){
  if(!confirm("Delete ALL sessions? Cannot be undone.")) return;
  localStorage.removeItem("hoh_sessions");
  toast("All sessions cleared"); renderHome(); renderSettings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SYNC â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setSyncDot(s){const d=document.getElementById("sync-dot");if(d) d.className="sync-dot "+s;}

async function syncToSheets(payload){
  if(!sheetsURL) return false;
  setSyncDot("syncing");
  try{
    fetch(sheetsURL,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain"},body:JSON.stringify(payload)});
    await new Promise(r=>setTimeout(r,1500));
    setSyncDot("synced"); return true;
  }catch(e){setSyncDot("error");return false;}
}

async function syncSession(rec){
  const ok=await syncToSheets({type:"session",rows:rec.rows||[]});
  if(ok){const s=getSaved();const i=s.findIndex(x=>x.date===rec.date&&x.label===rec.label);if(i>=0){s[i].synced=true;try{localStorage.setItem("hoh_sessions",JSON.stringify(s));}catch(e){}}}
}
async function syncPR(name,lift,newV,old,unit){await syncToSheets({type:"pr",date:new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"}),athlete:name,lift,newVal:newV,oldVal:old,unit,notes:""});}

async function forceSyncAll(){
  const s=getSaved().filter(x=>!x.synced&&x.rows);
  if(!s.length){alert("Nothing to sync.");return;}
  toast(`Syncing ${s.length} sessionsâ€¦`);
  let c=0; for(const x of s){const ok=await syncToSheets({type:"session",rows:x.rows||[]});if(ok) c++;}
  toast(`âœ“ Synced ${c} sessions`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSettings(){
  document.getElementById("sheets-url").value=sheetsURL||"";
  document.getElementById("local-count").textContent=getSaved().length;
  document.getElementById("script-display").textContent=APPS_SCRIPT_CODE;
  const st=document.getElementById("sync-status-text");
  if(sheetsURL){st.textContent="URL configured âœ“";st.style.color="var(--green)";}
  else{st.textContent="Not configured";st.style.color="var(--muted)";}
}

async function saveSheetURL(){
  const url=document.getElementById("sheets-url").value.trim();
  if(!url){alert("Please enter a URL.");return;}
  sheetsURL=url; localStorage.setItem("hoh_url",url);
  toast("Testing connectionâ€¦");
  const ok=await syncToSheets({type:"ping"});
  toast(ok?"âœ“ Connected! Check Sheets for ping row.":"âš  Could not connect â€” check URL");
  renderSettings();
}
function clearSheetURL(){if(!confirm("Remove URL?")) return;sheetsURL="";localStorage.removeItem("hoh_url");renderSettings();toast("URL cleared");}
function copyScript(){navigator.clipboard.writeText(APPS_SCRIPT_CODE).then(()=>toast("âœ“ Script copied!")).catch(()=>{const el=document.getElementById("script-display");const r=document.createRange();r.selectNode(el);window.getSelection().removeAllRanges();window.getSelection().addRange(r);document.execCommand("copy");toast("âœ“ Script copied!");});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getSaved(){try{return JSON.parse(localStorage.getItem("hoh_sessions")||"[]");}catch(e){return[];}}
function toast(msg){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),3000);}

// INIT
renderHome();
if(sheetsURL) setSyncDot("synced");
</script>
</body>
</html>